<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" th:replace="layout :: content">
<head>
    <title th:fragment="title" th:text="'Board - ' + ${post.title}">Board - 상세</title>
</head>
<body>
<section>
    <h1 th:text="${post.title}">제목</h1>
    <div class="meta">
        <span th:text="${post.author.username}">작성자</span> ·
        <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">작성일</span>
    </div>
    <article class="content" th:utext="${#strings.replace(post.content, '\n', '<br/>')}">내용</article>

    <div class="actions" th:if="${#authorization.expression('isAuthenticated()')}">
        <form th:if="${#authentication.name == post.author.username}" th:action="@{|/posts/${post.id}/edit|}" method="get" style="display:inline">
            <button type="submit">수정</button>
        </form>
        <form th:if="${#authentication.name == post.author.username}" th:action="@{|/posts/${post.id}/delete|}" method="post" style="display:inline">
            <button type="submit" onclick="return confirm('삭제하시겠습니까?')">삭제</button>
        </form>
    </div>

    <hr>
    <h2>댓글</h2>
    <div th:if="${post.comments.size() == 0}">댓글이 없습니다.</div>
    <ul class="comment-list" th:if="${post.comments.size() > 0}">
        <li th:each="c : ${post.comments}">
            <div>
                <b th:text="${c.author.username}">작성자</b>
                <span class="date" th:text="${#temporals.format(c.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
            </div>
            <div th:text="${c.content}">내용</div>
            <form th:if="${#authorization.expression('isAuthenticated()') && #authentication.name == c.author.username}"
                  th:action="@{|/comments/${c.id}/delete|}" method="post">
                <input type="hidden" name="postId" th:value="${post.id}">
                <button type="submit">댓글 삭제</button>
            </form>
        </li>
    </ul>

    <div th:if="${#authorization.expression('isAuthenticated()')}">
        <h3>댓글 작성</h3>
        <form method="post" th:action="@{|/comments/${post.id}/write|}">
            <textarea name="content" rows="4" maxlength="1000" required></textarea>
            <button type="submit">등록</button>
        </form>
    </div>

    <div class="error" th:if="${error}" th:text="${error}"></div>
</section>
</body>
</html>
